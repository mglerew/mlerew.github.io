<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FSM Module | Digital Lock</title>
    <link rel="stylesheet" href="../../style.css"> </head>
<body>
    <nav>
        <div class="container">
            <a href="../lock.html">‚Üê Back to Project Overview</a>
        </div>
    </nav>

    <main class="container">
        <h2>Finite State Machine (FSM) Implementation</h2>
        <p>The FSM serves as the "brain" of the lock, utilizing a 4-bit Moore model state machine to track security progress[cite: 31, 34].</p>

        <h3>Core SystemVerilog Logic</h3>
        <pre><code class="code-block">
typedef enum logic [3:0] {
    LS0   = 0,
    LS1   = 1,
    LS2   = 2,
    LS3   = 3,
    LS4   = 4,
    LS5   = 5,
    LS6   = 6,
    LS7   = 7,
    INIT  = 8,
    OPEN  = 9,
    ALARM = 10
} state_t;

module fsm(
    input  logic clk,
    input  logic rst,
    input  logic [4:0] keyout,
    input  logic [7:0] seq,
    output logic [3:0] state
);
    state_t curr_state, next_state;
    logic match_bit;
    logic reset_cmd;

    assign state = curr_state;

    always_ff @(posedge clk or posedge rst) begin
        if (rst)
            curr_state <= INIT;
        else
            curr_state <= next_state;
    end

    always_comb begin
        next_state = curr_state;
        match_bit  = 1'b0;
        reset_cmd  = 1'b0;

        reset_cmd = (keyout == 5'h10);

        if ((curr_state <= LS7) && !reset_cmd)
            match_bit = (keyout[0] == seq[~curr_state[2:0]]);

        casez ({curr_state, match_bit, reset_cmd})
            {LS0, 1'b1, 1'b0}: next_state = LS1;
            {LS1, 1'b1, 1'b0}: next_state = LS2;
            {LS2, 1'b1, 1'b0}: next_state = LS3;
            {LS3, 1'b1, 1'b0}: next_state = LS4;
            {LS4, 1'b1, 1'b0}: next_state = LS5;
            {LS5, 1'b1, 1'b0}: next_state = LS6;
            {LS6, 1'b1, 1'b0}: next_state = LS7;
            {LS7, 1'b1, 1'b0}: next_state = OPEN;

            {LS0, 1'b0, 1'b0},
            {LS1, 1'b0, 1'b0},
            {LS2, 1'b0, 1'b0},
            {LS3, 1'b0, 1'b0},
            {LS4, 1'b0, 1'b0},
            {LS5, 1'b0, 1'b0},
            {LS6, 1'b0, 1'b0},
            {LS7, 1'b0, 1'b0}: next_state = ALARM;

            {INIT, 1'b?, 1'b1},
            {OPEN, 1'b?, 1'b1},
            {LS0,  1'b?, 1'b1},
            {LS1,  1'b?, 1'b1},
            {LS2,  1'b?, 1'b1},
            {LS3,  1'b?, 1'b1},
            {LS4,  1'b?, 1'b1},
            {LS5,  1'b?, 1'b1},
            {LS6,  1'b?, 1'b1},
            {LS7,  1'b?, 1'b1}: next_state = LS0;

            default: next_state = curr_state;
        endcase
    end
endmodule
        </code></pre>
    </main>
</body>
</html>
